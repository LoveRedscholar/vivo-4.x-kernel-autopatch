# vivo-4.x-kernel-autopatch

*工具目前处于加密状态 ← 意味着你暂时没法用哦 :p*  
*即将发布，绝不鸽*  

---

<img src="https://raw.githubusercontent.com/4accccc/vivo-4x-kernel-patch/refs/heads/main/autopatch-eng.png" width="27%" alt="示例截图（英文界面）">
<img src="https://raw.githubusercontent.com/4accccc/vivo-4x-kernel-patch/refs/heads/main/autopatch-chn.png" width="25%" alt="示例截图（中文界面）">
<img src="https://raw.githubusercontent.com/4accccc/vivo-4x-kernel-patch/refs/heads/main/after_patch.png" width="50%" alt="补丁生效效果图">

---

[发布版本](https://github.com/LoveRedscholar/vivo-4.x-kernel-autopatch/releases)

### ⚠️警告
修改设备内核极易导致设备永久变砖（俗称“砖机”）。如果你知晓此风险，或怀疑本工具包含病毒™，请不要使用本工具。

---

### 状态标识说明
- ❓：需要更多反馈验证
- ✔️：测试通过
- ❌：出现问题

| 内核版本          | 4.14.94+ | 4.14.98 | 4.14.141+ | 4.14.186 | 4.14.190 | 4.19.191+ |
| ----------------- | :------: | :-----: | :-------: | :------: | :------: | :-------: |
| **适配状态**      |    ❓    |   ❓    |    ✔️     |    ❌¹    |    ❌¹    |    ❌¹    |

> ¹：挂载修复功能会导致设备进入重启循环，且Magisk无法正常工作

---

### 已完成功能
- 自动解压boot镜像并提取内核文件 ✔️  
- 自动为内核打补丁 ✔️  
- 自动重新打包boot镜像 ✔️  

---

### 功能详情（含缺失功能补充）
#### 🔧 自动检测内核版本功能（新增补充）
> 注：该功能为解决原工具无内核版本自动检测问题的核心补充功能
1. **功能逻辑**：
   - 自动识别内核文件的压缩格式（gzip/lz4/xz等），若为压缩文件则先解压；
   - 从内核文件中读取`Linux version x.y.z-xxx`格式的版本字符串；
   - 支持内核文件类型：Image、zImage、vmlinuz。
2. **技术实现**：
   - 基于C#编写，通过文件字节流读取与正则匹配实现版本解析；
   - 兼容压缩/未压缩内核文件，与工具原有解压逻辑联动。

#### 🆕 其他新功能规划
- 当内核文件为压缩格式时，自动解压内核（与版本检测功能联动）  
- 将挂载修复功能设置为可选项，用户可手动选择是否启用  

---

### 待修复问题
- 程序意外退出后，部分临时文件无法被自动删除  
- 自定义保存路径功能无效  
- （已解决）无法正确读取Linux内核版本信息（通过新增的版本检测功能修复）  
- 原版本的翻译内容存在错误（已同步修正为中文）  

---

### 补充说明
1. 本工具的主体开发工作已完成，采用**C#编程语言**开发。~~目前我们正针对**部分特定机型**修复部分SELinux策略，以让Magisk正常工作。~~ 请注意，本工具仅负责对内核进行补丁处理，**不会修复由SELinux或其他非内核层面问题导致的故障**，这是本工具的唯一功能。  

2. 好吧，我放弃了。~~该死的vivo~~ 部分机型的限制不仅存在于内核中，还存在于/vendor分区及其他位置。我至今仍无法让magiskd正常运行，也无法让post-fs-data在开机时执行。我可以确定的是，对于**部分特定机型**，仅靠打内核补丁无法让Magisk正常工作。~~但Magisk suu居然能完美运行，简直离谱~~ 如果本补丁对你的机型无效，你可以退而求其次使用Magisk suu替代。  

3. ~~该死的vivo，该死的BBK，看看你们都做了些什么！~~  

4. 考虑到部分机型在解锁system分区后会出现无法开机的情况，因此本分支将**不执行解锁system分区的操作**，避免机型因system分区解锁导致的开机故障。
